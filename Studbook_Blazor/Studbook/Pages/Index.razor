@page "/"
@inject ICalculationService calc

<div class="index-container">
    <div class="content">
        <div class="subjects">
            <div class="rating">
                @Rating
            </div>
            @foreach (Subject subject in Subjects)
            {
                <SubjectEntry @key=subject
                              Subject=subject
                              RemoveCallback=@RemoveSubject
                              OnChange=@(() => calc.CalculateRating(Subjects))>
                </SubjectEntry>
            }
        </div>
        @if (Subjects.Count < 10)
        {
            <div class="button-padding">
                <Button Text="Додати предмет" OnClick=AddSubject></Button>
            </div>
        }
    </div>
</div>

@code {
    List<Subject> Subjects { get; set; } = new();

    double Rating { get; set; }

    protected override void OnInitialized()
    {
        calc.RatingChanged += OnRatingChanged;
    }

    private void OnRatingChanged(object sender, double rating)
    {
        Rating = rating;
        StateHasChanged();
    }

    private void AddSubject()
    {
        Subject newSubject = new Subject();
        Subjects.Add(newSubject);
    }

    private void RemoveSubject(Subject subject)
    {
        Subjects.Remove(subject);
        calc.CalculateRating(Subjects);
    }
}